CONTAINER_NAME=kafka-broker1
CONTAINER_NETWORK_NAME=kafka-network
CONTAINER_HOST_NAME=kafka-broker1

PROJECT_PATH="$(dirname "$(dirname "$PWD")")"
BR_CONFIG_EXTERNAL_PATH="${PROJECT_PATH}/build/configs/server.properties"
BR_CONFIG_INTERNAL_PATH="/opt/bitnami/kafka/config/server.properties"

BR_DATA_EXTERNAL_PATH="${PROJECT_PATH}/volume/data"
BR_DATA_INTERNAL_PATH="/bitnami/kafka/data"

BR_LOG_EXTERNAL_PATH="${PROJECT_PATH}/volume/logs"
BR_LOG_INTERNAL_PATH="/bitnami/kafka/logs"



CLIENT_HOST_PORT=9092
CLIENT_CONTAINER_PORT=9092

# zookeeper baglanti kontrolu icin
# zookeeper cluster içerisindeki var olan zookeeper'lar tarafından ulaşılabilirliği test edilir.
# ZK_CONTAINER_NAMES="zookeeper1","zookeeper2","zookeeper3"
ZK_CONTAINER_NAMES="zookeeper1"
# HEALTH_CHECK_ZOOKEEPERS="zookeeper1:8080 zookeeper1:8081 zookeeper1:8082"
HEALTH_CHECK_ZOOKEEPERS="zookeeper1:8080"
ZK_GROUP_URL="/commands"
ZK_ENDPOINT_URL="/ruok"
ZK_HEALTH_EXPECTED_ERROR="\"error\" : null"

ZK_CONNECT_HOST="zookeeper1"
ZK_CONNECT_PORT=2181


HEALTHCHECK_TOPIC="healthcheck-topic"
RETRY_TOPIC="retry-topic"
DLQ_TOPIC="dlq-topic"
PRODUCER_HEALTHCHECK_MSG="healthcheck-message"
HEALTH_SUCCESS_MSG="and Zookeeper health check passed successfully."
CONSUMER_GROUP="health-check-group"

# HEALTH_CMD="bash $(pwd)/br-health-check.sh"
HEALTH_CMD="/opt/bitnami/kafka/bin/kafka-topics.sh --bootstrap-server ${CONTAINER_HOST_NAME}:${CLIENT_HOST_PORT} --list"
HEALTH_INTERVAL=10s
HEALTH_TIMEOUT=5s
HEALTH_RETRIES=3

MAX_RETRIES=7
RETRY_DELAY=13

RESTART_POLICY="on-failure"
RESTART_MAX_RETRIES=3

# Kafka Broker Configuration
KAFKA_CFG_BROKER_ID=1
KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP="PLAINTEXT:PLAINTEXT"
KAFKA_CFG_LISTENERS="PLAINTEXT://0.0.0.0:9092"
KAFKA_CFG_ADVERTISED_LISTENERS="PLAINTEXT://kafka-broker1:9092"
KAFKA_CFG_LISTENER_PORT=9092
KAFKA_CFG_ZOOKEEPER_CONNECT="zookeeper1:2181"
KAFKA_CFG_LOG_DIRS="/bitnami/kafka/data"
KAFKA_CFG_NUM_PARTITIONS=1
KAFKA_CFG_LOG_RETENTION_HOURS=168
KAFKA_CFG_LOG_RETENTION_CHECK_INTERVAL_MS=300000
KAFKA_CFG_NUM_IO_THREADS=8
KAFKA_CFG_NUM_NETWORK_THREADS=3
KAFKA_CFG_SOCKET_SEND_BUFFER_BYTES=102400
KAFKA_CFG_SOCKET_RECEIVE_BUFFER_BYTES=102400
KAFKA_CFG_SOCKET_REQUEST_MAX_BYTES=104857600
KAFKA_CFG_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
KAFKA_CFG_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_CFG_GROUP_INITIAL_REBALANCE_DELAY_MS=3000
ALLOW_PLAINTEXT_LISTENER=yes
CONTAINER_IMAGE=bitnami/kafka:latest